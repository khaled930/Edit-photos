<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Image Editor</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="/static/style.css">
</head>
<body>

<h1>Image Editing Platform</h1>

<form action="/upload" method="post" enctype="multipart/form-data">
    <input type="file" id="fileInput" name="file" accept="image/*" required>
    <button type="submit">Upload Image</button>
</form>

<div class="tools">
    {% if edited_url %}
        <a href="{{ edited_url }}" download>
            <button type="button">Save</button>
        </a>
    {% else %}
        <a href="{{ image_url }}" download>
            <button type="button"">Save</button>
        </a>
    {% endif %}

    <button type="button" onclick="openPopup('improve')">Improve</button>
    <button type="button" onclick="openPopup('compression')">Compression</button>
    <button type="button" onclick="openPopup('edit')">Edit</button>
</div>

<!-- ================= Improve ================= -->
<div class="popup" id="improve">
    <span class="close" onclick="closePopup()">×</span>

    <div style=" text-align:center;">
        <img id="image_1" src="{% if edited_url %}{{ edited_url }}{% else %}{{ image_url }}{% endif %}">
    </div>

    <h2>Image Enhancement</h2>

  <div class="row">

    <div class="col-6">

    <form action="/brightness" method="post">
        <input type="hidden" name="image_url" value="{% if edited_url %}{{ edited_url }}{% else %}{{ image_url }}{% endif %}">
        <label>Brightness</label><br>
        <input type="range" name="factor" min="0.2" max="2" step="0.1" value="1">
        <button type="submit">Apply</button>
    </form>

    <form action="/contrast" method="post">
        <input type="hidden" name="image_url" value="{% if edited_url %}{{ edited_url }}{% else %}{{ image_url }}{% endif %}">
        <label>Contrast</label><br>
        <input type="range" name="factor" min="0.2" max="2" step="0.1" value="1">
        <button type="submit">Apply</button>
    </form>

    <form action="/sharpen" method="post" style="display:inline;">
        <input type="hidden" name="image_url" value="{% if edited_url %}{{ edited_url }}{% else %}{{ image_url }}{% endif %}">
        <button type="submit">Sharpen</button>
    </form>

    <form action="/smooth" method="post" style="display:inline;">
        <input type="hidden" name="image_url" value="{% if edited_url %}{{ edited_url }}{% else %}{{ image_url }}{% endif %}">
        <button type="submit">Smooth</button>
    </form>
    </div>
    
    <div class="col-6">

    <form action="/histogram" method="post">
        <input type="hidden" name="image_url" value="{% if edited_url %}{{ edited_url }}{% else %}{{ image_url }}{% endif %}">
        <button type="submit">Show Histogram</button>
    </form>

    {% if histogram_url %}
        <h3>Histogram</h3>
        <img src="{{ histogram_url }}" style="max-width:100%;">
    {% endif %}
    </div>

 </div>

</div>

<!-- ================= Compression ================= -->
<div class="popup" id="compression">
    <span class="close" onclick="closePopup()">×</span>

    <div style="text-align:center;">
        <img id="image_2" src="{% if edited_url %}{{ edited_url }}{% else %}{{ image_url }}{% endif %}">
    </div>

    <h2>JPEG Compression</h2>

    <form action="/compress" method="post">
        <input type="hidden" name="image_url" value="{% if edited_url %}{{ edited_url }}{% else %}{{ image_url }}{% endif %}">
        <label>Compression Quality (1 - 95)</label><br>
        <input type="number" name="quality" value="70" min="1" max="95" required>
        <button type="submit">Compress Image</button>
    </form>

    {% if compressed_url %}
        <h3>Compressed Result</h3>
        <p>
            Size Before: {{ stats.before_kb }} KB <br>
            Size After: {{ stats.after_kb }} KB <br>
            Compression Ratio: {{ stats.ratio }}
        </p>
    {% endif %}
</div>

<!-- ================= Edit ================= -->
<div class="popup" id="edit">
    <span class="close" onclick="closePopup()">×</span>

    <h2>Crop Image</h2>

    <div id="crop-frame">
        <img id="image" src="{% if edited_url %}{{ edited_url }}{% else %}{{ image_url }}{% endif %}">
        <div id="crop-box" style="display:none;">
            <span class="handle tl"></span>
            <span class="handle tr"></span>
            <span class="handle bl"></span>
            <span class="handle br"></span>
        </div>
    </div>

    <button onclick="enableCrop()">Crop Mode</button>
    <button onclick="submitCrop()">Save Crop</button>

    <form action="/rotate" method="post">
        <input type="hidden" name="image_url" value="{% if edited_url %}{{ edited_url }}{% else %}{{ image_url }}{% endif %}">
        <select name="angle">
            <option value="0">0°</option>
            <option value="90">90°</option>
            <option value="180">180°</option>
            <option value="270">270°</option>
        </select>
        <button type="submit">Rotate</button>
    </form>

    <form id="crop-form" action="/crop" method="post">
        <input type="hidden" name="image_url" value="{% if edited_url %}{{ edited_url }}{% else %}{{ image_url }}{% endif %}">
        <input type="hidden" id="x" name="x">
        <input type="hidden" id="y" name="y">
        <input type="hidden" id="width" name="width">
        <input type="hidden" id="height" name="height">
    </form>
</div>

<hr>

<div id="image-container">
    {% if edited_url %}
        <img src="{{ edited_url }}">
    {% else %}
        <img src="{{ image_url }}">
    {% endif %}
</div>

<script src="/static/script.js"></script>

</body>
</html>
